<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Grounded Theory Coding Studio | SIM Lab @ SIUE</title>
  <meta name="description" content="A full grounded theory coding worksheet â€” open, axial, and selective coding â€” for music video analysis. Export to Markdown or QMD.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,600;1,400&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --ink:       #1a1a2e;
      --ink-soft:  #3d3d5c;
      --teal:      #0d7377;
      --teal-dark: #085a5e;
      --teal-light:#e8f4f5;
      --amber:     #e8871a;
      --amber-pale:#fff4e6;
      --rose:      #c45c8a;
      --rose-pale: #fdf0f6;
      --paper:     #f9f7f4;
      --panel:     #ffffff;
      --stroke:    rgba(26,26,46,0.12);
      --shadow-sm: 0 2px 8px rgba(26,26,46,0.08);
      --shadow-md: 0 8px 24px rgba(26,26,46,0.12);
      --shadow-lg: 0 20px 48px rgba(26,26,46,0.16);
      --mono:      "DM Mono", monospace;
    }

    *, *::before, *::after { box-sizing: border-box; }

    html { scroll-behavior: smooth; }

    body {
      margin: 0;
      font-family: "DM Sans", system-ui, sans-serif;
      font-size: 15px;
      line-height: 1.65;
      color: var(--ink);
      background: var(--paper);
      background-image:
        radial-gradient(ellipse 800px 500px at 0% 0%, rgba(13,115,119,0.07) 0%, transparent 70%),
        radial-gradient(ellipse 600px 400px at 100% 100%, rgba(232,135,26,0.07) 0%, transparent 70%);
    }

    /* â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .shell {
      min-height: 100vh;
      padding: 0 16px 80px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .wrap {
      width: min(1120px, 100%);
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    /* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .site-header {
      background: linear-gradient(135deg, #0c2d42 0%, #0d6c70 50%, #0d7377 100%);
      color: #fff;
      padding: 36px 40px 32px;
      margin-bottom: 32px;
      border-radius: 0 0 32px 32px;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-lg);
    }

    .site-header::before {
      content: "";
      position: absolute;
      inset: 0;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.04'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }

    .site-header::after {
      content: "";
      position: absolute;
      right: -80px;
      top: -80px;
      width: 320px;
      height: 320px;
      background: radial-gradient(circle, rgba(232,135,26,0.25), transparent 65%);
      pointer-events: none;
    }

    .header-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      position: relative;
      z-index: 1;
    }

    .nav-home {
      color: rgba(255,255,255,0.9);
      text-decoration: none;
      font-size: 0.85rem;
      font-weight: 500;
      letter-spacing: 0.03em;
      background: rgba(255,255,255,0.15);
      padding: 7px 16px;
      border-radius: 99px;
      border: 1px solid rgba(255,255,255,0.2);
      transition: background 0.2s;
    }
    .nav-home:hover { background: rgba(255,255,255,0.28); }

    .header-badge {
      font-size: 0.78rem;
      font-weight: 500;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.7);
      background: rgba(255,255,255,0.12);
      padding: 5px 12px;
      border-radius: 99px;
    }

    .site-header h1 {
      font-family: "Playfair Display", Georgia, serif;
      font-size: clamp(2rem, 4vw, 3.2rem);
      font-weight: 600;
      margin: 0 0 10px;
      line-height: 1.15;
      position: relative;
      z-index: 1;
    }

    .site-header h1 em {
      font-style: italic;
      color: #ffc96b;
    }

    .site-header .subtitle {
      font-size: 1rem;
      color: rgba(255,255,255,0.8);
      max-width: 680px;
      margin: 0;
      position: relative;
      z-index: 1;
    }

    /* â”€â”€ PHASE TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .phase-nav {
      display: flex;
      gap: 0;
      background: var(--panel);
      border-radius: 16px;
      padding: 6px;
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow-sm);
      margin-bottom: 24px;
      position: sticky;
      top: 12px;
      z-index: 100;
    }

    .phase-tab {
      flex: 1;
      padding: 10px 16px;
      border-radius: 10px;
      border: none;
      background: transparent;
      font-family: "DM Sans", sans-serif;
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--ink-soft);
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .phase-tab .tab-num {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      font-size: 0.75rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--stroke);
    }

    .phase-tab[data-phase="open"].active,
    .phase-tab[data-phase="open"]:hover {
      background: var(--teal-light);
      color: var(--teal-dark);
    }
    .phase-tab[data-phase="open"].active .tab-num { background: var(--teal); color: #fff; }

    .phase-tab[data-phase="axial"].active,
    .phase-tab[data-phase="axial"]:hover {
      background: var(--amber-pale);
      color: #7a4500;
    }
    .phase-tab[data-phase="axial"].active .tab-num { background: var(--amber); color: #fff; }

    .phase-tab[data-phase="selective"].active,
    .phase-tab[data-phase="selective"]:hover {
      background: var(--rose-pale);
      color: #7a1a48;
    }
    .phase-tab[data-phase="selective"].active .tab-num { background: var(--rose); color: #fff; }

    /* â”€â”€ PANELS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .phase-panel { display: none; flex-direction: column; gap: 20px; }
    .phase-panel.active { display: flex; }

    /* â”€â”€ CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card {
      background: var(--panel);
      border-radius: 20px;
      padding: 24px 28px;
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow-sm);
    }

    .card.accent-teal   { border-left: 4px solid var(--teal); }
    .card.accent-amber  { border-left: 4px solid var(--amber); }
    .card.accent-rose   { border-left: 4px solid var(--rose); }

    .card-header {
      display: flex;
      align-items: flex-start;
      gap: 14px;
      margin-bottom: 18px;
    }

    .card-icon {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .card-icon.teal   { background: var(--teal-light); }
    .card-icon.amber  { background: var(--amber-pale); }
    .card-icon.rose   { background: var(--rose-pale); }

    .card-title { margin: 0 0 4px; font-size: 1.15rem; font-weight: 600; }
    .card-desc  { margin: 0; font-size: 0.88rem; color: var(--ink-soft); }

    /* â”€â”€ THEORY BOX â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .theory-box {
      border-radius: 14px;
      padding: 16px 20px;
      font-size: 0.87rem;
      line-height: 1.6;
      margin-bottom: 20px;
    }
    .theory-box.teal   { background: var(--teal-light);  border-left: 3px solid var(--teal); }
    .theory-box.amber  { background: var(--amber-pale);  border-left: 3px solid var(--amber); }
    .theory-box.rose   { background: var(--rose-pale);   border-left: 3px solid var(--rose); }

    .theory-box strong { display: block; margin-bottom: 6px; font-size: 0.82rem; letter-spacing: 0.05em; text-transform: uppercase; }

    /* â”€â”€ GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; }
    .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }

    /* â”€â”€ FIELDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .field { display: flex; flex-direction: column; gap: 6px; }
    .field-group { display: flex; flex-direction: column; gap: 14px; }

    label {
      font-weight: 600;
      font-size: 0.87rem;
      letter-spacing: 0.01em;
      color: var(--ink-soft);
    }

    label .hint {
      font-weight: 400;
      font-size: 0.8rem;
      color: #888;
      margin-top: 2px;
      display: block;
    }

    input[type="text"],
    input[type="url"],
    textarea,
    select {
      font-family: "DM Sans", sans-serif;
      font-size: 0.9rem;
      padding: 10px 14px;
      border-radius: 10px;
      border: 1.5px solid var(--stroke);
      background: #fcfbf9;
      color: var(--ink);
      transition: border-color 0.2s, box-shadow 0.2s;
      resize: vertical;
    }

    textarea { min-height: 88px; }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--teal);
      box-shadow: 0 0 0 3px rgba(13,115,119,0.12);
    }

    fieldset { border: none; padding: 0; margin: 0; }

    legend {
      font-weight: 700;
      font-size: 0.82rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--teal);
      margin-bottom: 14px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--teal-light);
      width: 100%;
    }

    legend.amber { color: var(--amber); border-bottom-color: var(--amber-pale); }
    legend.rose  { color: var(--rose);  border-bottom-color: var(--rose-pale); }

    /* â”€â”€ THEME BLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .theme-block {
      background: #fafaf8;
      border: 1.5px solid var(--stroke);
      border-radius: 14px;
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .theme-block-header {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .theme-num {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--teal);
      color: #fff;
      font-size: 0.8rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .theme-num.amber { background: var(--amber); }
    .theme-num.rose  { background: var(--rose); }

    /* â”€â”€ RELATIONSHIP BLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .relation-block {
      background: #fafaf8;
      border: 1.5px solid var(--stroke);
      border-radius: 14px;
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .relation-header { display: flex; align-items: center; gap: 8px; font-weight: 600; font-size: 0.9rem; }

    .arrow-badge {
      background: var(--amber-pale);
      color: #7a4500;
      border-radius: 8px;
      padding: 3px 10px;
      font-size: 0.8rem;
      font-weight: 700;
      font-family: var(--mono);
    }

    /* â”€â”€ IMPORT AREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .import-area {
      border: 2px dashed var(--stroke);
      border-radius: 14px;
      padding: 20px;
      background: #fafaf8;
    }

    .import-area textarea { background: #f3f3f0; font-family: var(--mono); font-size: 0.82rem; }

    /* â”€â”€ ACTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 16px;
      align-items: center;
    }

    .btn {
      border: none;
      padding: 11px 22px;
      border-radius: 99px;
      font-family: "DM Sans", sans-serif;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.18s;
      display: inline-flex;
      align-items: center;
      gap: 7px;
    }

    .btn-primary  { background: var(--teal);  color: #fff; box-shadow: 0 6px 18px rgba(13,115,119,0.28); }
    .btn-primary:hover { background: var(--teal-dark); transform: translateY(-1px); }

    .btn-amber    { background: var(--amber); color: #fff; box-shadow: 0 6px 18px rgba(232,135,26,0.28); }
    .btn-amber:hover { transform: translateY(-1px); }

    .btn-rose     { background: var(--rose);  color: #fff; box-shadow: 0 6px 18px rgba(196,92,138,0.28); }
    .btn-rose:hover { transform: translateY(-1px); }

    .btn-ghost    { background: transparent; border: 1.5px solid var(--stroke); color: var(--ink-soft); }
    .btn-ghost:hover { border-color: var(--teal); color: var(--teal); }

    .btn-sm { padding: 7px 14px; font-size: 0.82rem; }

    /* â”€â”€ OUTPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .output-area {
      margin-top: 20px;
      border-top: 1px solid var(--stroke);
      padding-top: 20px;
    }

    .output-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .out-tab {
      padding: 6px 16px;
      border-radius: 8px;
      border: 1.5px solid var(--stroke);
      background: transparent;
      font-family: "DM Sans", sans-serif;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      color: var(--ink-soft);
    }

    .out-tab.active { background: var(--ink); color: #fff; border-color: var(--ink); }

    .output-area textarea {
      width: 100%;
      min-height: 240px;
      font-family: var(--mono);
      font-size: 0.82rem;
      background: #0e1e2e;
      color: #a8d8d8;
      border-color: #1e3040;
      border-radius: 14px;
      padding: 16px 18px;
    }

    /* â”€â”€ PROGRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .progress-bar {
      display: flex;
      gap: 4px;
      margin-bottom: 24px;
      align-items: center;
    }

    .progress-step {
      flex: 1;
      height: 4px;
      border-radius: 4px;
      background: var(--stroke);
      transition: background 0.4s;
    }

    .progress-step.done-teal     { background: var(--teal); }
    .progress-step.done-amber    { background: var(--amber); }
    .progress-step.done-rose     { background: var(--rose); }

    /* â”€â”€ GUIDE CALLOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .guide {
      background: linear-gradient(135deg, var(--teal-light), #e0eeef);
      border-radius: 14px;
      padding: 18px 22px;
      font-size: 0.87rem;
      line-height: 1.65;
    }

    .guide ol { margin: 8px 0 0; padding-left: 20px; }
    .guide li { margin-bottom: 5px; }

    /* â”€â”€ STATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 5px 12px;
      border-radius: 99px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .status-pill.success { background: #e6f7ef; color: #0a7a4e; }
    .status-pill.info    { background: var(--teal-light); color: var(--teal-dark); }

    /* â”€â”€ SEPARATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .separator {
      border: none;
      border-top: 1px solid var(--stroke);
      margin: 20px 0;
    }

    /* â”€â”€ FADE ANIMATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .fade-up { animation: fadeUp 0.6s ease both; }
    .d1 { animation-delay: 0.1s; }
    .d2 { animation-delay: 0.2s; }
    .d3 { animation-delay: 0.3s; }

    @media (prefers-reduced-motion: reduce) { .fade-up { animation: none; } }

    /* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 680px) {
      .site-header { padding: 24px 20px; border-radius: 0 0 20px 20px; }
      .card { padding: 18px 16px; }
      .phase-tab { font-size: 0.8rem; padding: 8px 10px; }
      .phase-tab span.label { display: none; }
    }
  </style>
</head>
<body>
<div class="shell">
<div class="wrap">

  <!-- HEADER -->
  <header class="site-header fade-up">
    <div class="header-nav">
      <span class="header-badge">SIM Lab @ SIUE</span>
    </div>
    <h1>Grounded Theory<br><em>Coding Studio</em></h1>
    <p class="subtitle">Open â†’ Axial â†’ Selective coding for music video analysis. Complete all three phases and export a .qmd file for your Obsidian vault.</p>
  </header>

  <!-- MAIN FORM -->
  <main class="fade-up d1">

    <!-- PHASE TABS -->
    <nav class="phase-nav" role="tablist" aria-label="Coding phases">
      <button class="phase-tab active" data-phase="open" role="tab" aria-selected="true" aria-controls="panel-open">
        <span class="tab-num">1</span>
        <span class="label">Open Coding</span>
      </button>
      <button class="phase-tab" data-phase="axial" role="tab" aria-selected="false" aria-controls="panel-axial">
        <span class="tab-num">2</span>
        <span class="label">Axial Coding</span>
      </button>
      <button class="phase-tab" data-phase="selective" role="tab" aria-selected="false" aria-controls="panel-selective">
        <span class="tab-num">3</span>
        <span class="label">Selective Coding</span>
      </button>
      <button class="phase-tab" data-phase="export" role="tab" aria-selected="false" aria-controls="panel-export">
        <span class="tab-num">â†“</span>
        <span class="label">Export</span>
      </button>
    </nav>

    <!-- PROGRESS -->
    <div class="progress-bar" aria-hidden="true">
      <div class="progress-step" id="prog-open"></div>
      <div class="progress-step" id="prog-axial"></div>
      <div class="progress-step" id="prog-selective"></div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- PANEL 1: OPEN CODING                               -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="phase-panel active" id="panel-open" role="tabpanel">

      <div class="card accent-teal">
        <div class="theory-box teal">
          <strong>ğŸ“– What is Open Coding?</strong>
          In grounded theory, <em>open coding</em> is the first stage of analysis. You listen/watch with fresh eyes and label everything you notice â€” sounds, words, images, feelings â€” without forcing a framework. These raw labels are your initial codes. The goal is to break the text open and identify as many distinct concepts as possible before grouping them.
        </div>

        <fieldset>
          <legend>Song / Video Metadata</legend>
          <div class="grid-2">
            <div class="field">
              <label for="song-title">Song title <span class="hint">Used as the document heading in your .qmd</span></label>
              <input id="song-title" type="text" placeholder="e.g. Ocean Eyes">
            </div>
            <div class="field">
              <label for="song-artist">Artist / group</label>
              <input id="song-artist" type="text" placeholder="e.g. Billie Eilish">
            </div>
            <div class="field">
              <label for="song-year">Release year</label>
              <input id="song-year" type="text" placeholder="e.g. 2016">
            </div>
            <div class="field">
              <label for="song-genre">Genre(s)</label>
              <input id="song-genre" type="text" placeholder="e.g. Dream pop, indie">
            </div>
            <div class="field" style="grid-column: 1 / -1;">
              <label for="song-link">YouTube / Spotify link</label>
              <input id="song-link" type="url" placeholder="https://www.youtube.com/watch?v=...">
            </div>
          </div>
        </fieldset>

        <hr class="separator">

        <fieldset>
          <legend>Structured Listening (2 passes)</legend>
          <div class="guide" style="margin-bottom: 16px;">
            <strong style="font-size:0.85rem;">Listening protocol:</strong>
            <ol>
              <li><strong>Pass 1 â€” Sound only:</strong> mute lyrics and notice tempo, key, instrumentation, production style.</li>
              <li><strong>Pass 2 â€” Content:</strong> focus on lyrics, narrative, imagery in the video.</li>
            </ol>
          </div>
          <div class="grid-2">
            <div class="field">
              <label for="sound-notes">Pass 1 â€” Sound notes <span class="hint">Tempo, key, instruments, production</span></label>
              <textarea id="sound-notes" placeholder="What do you hear? Fast/slow? Sparse/dense? Major/minor?"></textarea>
            </div>
            <div class="field">
              <label for="content-notes">Pass 2 â€” Content notes <span class="hint">Lyrics, narrative, visual imagery</span></label>
              <textarea id="content-notes" placeholder="What's the story? Who speaks? What images appear?"></textarea>
            </div>
          </div>
        </fieldset>

        <hr class="separator">

        <fieldset>
          <legend>Initial Code Prompts â€” Label everything you notice</legend>
          <div class="grid-2">
            <div class="field">
              <label for="lyrical-themes">Lyrical themes &amp; content</label>
              <textarea id="lyrical-themes" placeholder="Relationships, emotions, social commentary, lifestyle, place, identity..."></textarea>
            </div>
            <div class="field">
              <label for="emotional-tone">Emotional &amp; affective tone</label>
              <textarea id="emotional-tone" placeholder="Sentiment (positive/negative/ambivalent), intensity, mood shifts..."></textarea>
            </div>
            <div class="field">
              <label for="structural-elements">Structural &amp; linguistic elements</label>
              <textarea id="structural-elements" placeholder="Perspective (I/we/they), repetition, chorus vs verse, imagery, metaphor..."></textarea>
            </div>
            <div class="field">
              <label for="musical-features">Musical &amp; sonic features</label>
              <textarea id="musical-features" placeholder="Tempo, rhythm, instrumentation, vocal style, dynamics, silence..."></textarea>
            </div>
            <div class="field">
              <label for="visual-elements">Visual &amp; video elements <span class="hint">If a music video is available</span></label>
              <textarea id="visual-elements" placeholder="Setting, color palette, costume, performance vs narrative, symbolism..."></textarea>
            </div>
            <div class="field">
              <label for="contextual-factors">Contextual factors</label>
              <textarea id="contextual-factors" placeholder="Time period, cultural context, artist persona, genre conventions..."></textarea>
            </div>
            <div class="field" style="grid-column: 1 / -1;">
              <label for="additional-notes">Additional observations &amp; quick codes</label>
              <textarea id="additional-notes" placeholder="Anything else â€” jot raw codes here, no filter. In GT, nothing is too small."></textarea>
            </div>
          </div>
        </fieldset>

        <hr class="separator">

        <fieldset>
          <legend>Emergent Open Codes â€” Name 3â€“5 initial themes</legend>
          <div class="guide" style="margin-bottom: 16px;">
            Look across your notes above. What recurring concepts, tensions, or patterns do you see? Give each one a short label â€” these are your <strong>open codes</strong>. Don't worry about getting it "right"; these will evolve.
          </div>
          <div class="field-group" id="open-themes-container">
            <!-- Generated by JS -->
          </div>
        </fieldset>

        <div class="actions">
          <button class="btn btn-primary" id="btn-next-axial">Continue to Axial Coding â†’</button>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- PANEL 2: AXIAL CODING                              -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="phase-panel" id="panel-axial" role="tabpanel">

      <div class="card accent-amber">
        <div class="theory-box amber">
          <strong>ğŸ“– What is Axial Coding?</strong>
          <em>Axial coding</em> is the second stage, where you begin to connect your open codes. You look for <strong>categories</strong> (broader groupings) and explore the relationships <em>between</em> them â€” causes, conditions, contexts, consequences, and strategies. The "axis" is the pivot point connecting subcategories to a core category.
        </div>

        <fieldset>
          <legend class="amber">Step 1 â€” Group your open codes into categories</legend>
          <div class="guide" style="margin-bottom:16px; background: var(--amber-pale);">
            Look at the open codes you named in Phase 1. Which ones cluster together? Combine related codes into broader <strong>categories</strong>. Each category should have a name and a short description of what it captures.
          </div>
          <div class="field-group" id="axial-categories-container">
            <!-- Generated by JS -->
          </div>
        </fieldset>

        <hr class="separator">

        <fieldset>
          <legend class="amber">Step 2 â€” Explore relationships between categories</legend>
          <div class="guide" style="margin-bottom:16px; background: var(--amber-pale);">
            For each relationship, identify the two categories involved and describe <em>how</em> they connect. Use the relationship type to guide you. In GT, we look for: <strong>Causal conditions â†’ Phenomenon â†’ Context â†’ Intervening conditions â†’ Action/strategy â†’ Consequences</strong>.
          </div>
          <div class="field-group" id="relations-container">
            <!-- Generated by JS -->
          </div>
          <button class="btn btn-ghost btn-sm" id="btn-add-relation" style="margin-top:12px;">+ Add relationship</button>
        </fieldset>

        <hr class="separator">

        <fieldset>
          <legend class="amber">Step 3 â€” Paradigm model notes</legend>
          <div class="grid-2">
            <div class="field">
              <label for="causal-conditions">Causal conditions <span class="hint">What triggers or causes the central phenomenon?</span></label>
              <textarea id="causal-conditions" placeholder="e.g. Heartbreak triggers introspection..."></textarea>
            </div>
            <div class="field">
              <label for="phenomenon">Central phenomenon <span class="hint">The main concept / event / process you are analyzing</span></label>
              <textarea id="phenomenon" placeholder="e.g. The performance of vulnerability..."></textarea>
            </div>
            <div class="field">
              <label for="context-factors">Context <span class="hint">Specific conditions that shape the phenomenon</span></label>
              <textarea id="context-factors" placeholder="e.g. Genre, era, artist's age or identity..."></textarea>
            </div>
            <div class="field">
              <label for="intervening-cond">Intervening conditions <span class="hint">Broader structural factors that influence strategies</span></label>
              <textarea id="intervening-cond" placeholder="e.g. Commercial pressures, audience expectations..."></textarea>
            </div>
            <div class="field">
              <label for="action-strategies">Action / interaction strategies <span class="hint">How does the artist/text respond to the phenomenon?</span></label>
              <textarea id="action-strategies" placeholder="e.g. Use of whisper vocals to signal intimacy..."></textarea>
            </div>
            <div class="field">
              <label for="consequences">Consequences <span class="hint">Outcomes â€” for the artist, the audience, or the genre</span></label>
              <textarea id="consequences" placeholder="e.g. Listener identification, genre normalization..."></textarea>
            </div>
          </div>
        </fieldset>

        <div class="actions">
          <button class="btn btn-ghost" id="btn-back-open">â† Back to Open Coding</button>
          <button class="btn btn-amber" id="btn-next-selective">Continue to Selective Coding â†’</button>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- PANEL 3: SELECTIVE CODING                          -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="phase-panel" id="panel-selective" role="tabpanel">

      <div class="card accent-rose">
        <div class="theory-box rose">
          <strong>ğŸ“– What is Selective Coding?</strong>
          <em>Selective coding</em> is where the theory comes together. You select one <strong>core category</strong> â€” the central concept that all other categories relate to â€” and systematically connect everything around it. The result is a <em>storyline</em>: a narrative that integrates your categories and begins to explain <em>why</em> and <em>how</em> something works the way it does.
        </div>

        <fieldset>
          <legend class="rose">Core Category</legend>
          <div class="grid-2">
            <div class="field">
              <label for="core-category">Core category name <span class="hint">The single concept everything else revolves around</span></label>
              <input id="core-category" type="text" placeholder="e.g. Performed Vulnerability">
            </div>
            <div class="field">
              <label for="core-justification">Why this is the core <span class="hint">How does it relate to all other categories?</span></label>
              <textarea id="core-justification" placeholder="Explain why this category integrates the others..."></textarea>
            </div>
          </div>
        </fieldset>

        <hr class="separator">

        <fieldset>
          <legend class="rose">Story Line</legend>
          <div class="field">
            <label for="storyline">Integrated narrative <span class="hint">Write a paragraph that tells the story of your categories and their relationships</span></label>
            <textarea id="storyline" style="min-height: 130px;" placeholder="In this song, [artist] performs [phenomenon] by [strategies]. This is caused by [causal conditions] and occurs within the context of [context]. The outcome is [consequences]..."></textarea>
          </div>
        </fieldset>

        <hr class="separator">

        <fieldset>
          <legend class="rose">Theoretical Memo</legend>
          <div class="guide" style="margin-bottom:14px; background: var(--rose-pale);">
            <strong style="font-size:0.82rem;">What is a theoretical memo?</strong> Memos are informal notes to yourself about analytical decisions, hunches, contradictions, and emerging ideas. They are a core GT practice â€” write freely.
          </div>
          <div class="grid-2">
            <div class="field">
              <label for="memo-insights">Key analytical insights</label>
              <textarea id="memo-insights" placeholder="What surprised you? What pattern was unexpected?"></textarea>
            </div>
            <div class="field">
              <label for="memo-gaps">Gaps &amp; tensions</label>
              <textarea id="memo-gaps" placeholder="What doesn't fit? What would you need to check further?"></textarea>
            </div>
            <div class="field">
              <label for="memo-saturation">Theoretical saturation notes <span class="hint">Does more evidence confirm or challenge your categories?</span></label>
              <textarea id="memo-saturation" placeholder="How confident are you these categories hold?"></textarea>
            </div>
            <div class="field">
              <label for="memo-next">Next steps</label>
              <textarea id="memo-next" placeholder="What songs or texts would you compare this to next?"></textarea>
            </div>
          </div>
        </fieldset>

        <hr class="separator">

        <fieldset>
          <legend class="rose">Discussion Board Excerpt</legend>
          <div class="field">
            <label for="discussion-post">Post for class discussion <span class="hint">Share your core category + 1 piece of evidence. Keep it to 3â€“5 sentences.</span></label>
            <textarea id="discussion-post" placeholder="My core category is [X]. I see this in the song when [evidence]. This connects to [category] because..."></textarea>
          </div>
        </fieldset>

        <div class="actions">
          <button class="btn btn-ghost" id="btn-back-axial">â† Back to Axial Coding</button>
          <button class="btn btn-rose" id="btn-go-export">Generate &amp; Export â†’</button>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- PANEL 4: EXPORT                                    -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="phase-panel" id="panel-export" role="tabpanel">

      <!-- IMPORT -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon teal">ğŸ“¥</div>
          <div>
            <h2 class="card-title">Import a Previous QMD</h2>
            <p class="card-desc">Paste the contents of a saved .qmd file to repopulate all fields â€” useful for revising or continuing work.</p>
          </div>
        </div>
        <div class="import-area">
          <div class="field">
            <label for="import-qmd">Paste .qmd contents here</label>
            <textarea id="import-qmd" style="min-height:120px; font-family: var(--mono); font-size: 0.82rem; color: var(--ink);" placeholder="---&#10;title: &quot;My Song - Observations&quot;&#10;..."></textarea>
          </div>
          <div class="actions">
            <button class="btn btn-ghost" id="btn-import">â†‘ Populate fields from QMD</button>
            <button class="btn btn-ghost btn-sm" id="btn-clear-import">Clear</button>
          </div>
          <p id="import-status" style="font-size:0.83rem; color: var(--teal); margin-top:8px;"></p>
        </div>
      </div>

      <!-- EXPORT -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon teal">ğŸ“¤</div>
          <div>
            <h2 class="card-title">Generate &amp; Export</h2>
            <p class="card-desc">Generate your document, then copy as Markdown or download as a .qmd file for Obsidian.</p>
          </div>
        </div>

        <div class="actions">
          <button class="btn btn-primary" id="btn-generate">âš¡ Generate Document</button>
          <button class="btn btn-ghost" id="btn-copy-md">Copy Markdown</button>
          <button class="btn btn-ghost" id="btn-download-qmd">Download .qmd</button>
          <button class="btn btn-ghost" id="btn-download-md">Download .md</button>
        </div>

        <div class="output-area" id="output-area" style="display:none;">
          <div class="output-tabs">
            <button class="out-tab active" data-out="preview">Preview</button>
            <button class="out-tab" data-out="raw">Raw</button>
          </div>
          <textarea id="output-preview" readonly></textarea>
          <p style="font-size:0.82rem; color: var(--ink-soft); margin-top: 10px;">
            ğŸ’¡ Copy this into Obsidian or download as a <code>.qmd</code> file to open in RStudio / Quarto.
          </p>
        </div>
      </div>

      <div class="actions" style="margin-top: 0;">
        <button class="btn btn-ghost" id="btn-back-selective">â† Back to Selective Coding</button>
        <button class="btn btn-ghost btn-sm" id="btn-reset-all">ğŸ—‘ Reset all fields</button>
      </div>
    </div>

  </main>
</div>
</div>

<script>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   GROUNDED THEORY CODING STUDIO â€” Main Script
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const state = {
  openThemes: 5,
  axialCategories: 3,
  relations: 2,
};

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const get  = (id) => { const el = document.getElementById(id); return el ? el.value.trim() : ""; };
const set  = (id, v) => { const el = document.getElementById(id); if (el) el.value = v; };
const norm = (t) => t.replace(/\r\n/g, "\n");

function section(title, content, level = "##") {
  const c = norm(content.trim());
  if (!c) return "";
  return `${level} ${title}\n${c}\n`;
}

function bullet(label, value) {
  return value ? `- **${label}:** ${value}\n` : "";
}

// â”€â”€ Tab Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const tabs   = document.querySelectorAll(".phase-tab");
const panels = document.querySelectorAll(".phase-panel");

function switchTab(phase) {
  tabs.forEach(t => { t.classList.toggle("active", t.dataset.phase === phase); t.setAttribute("aria-selected", t.dataset.phase === phase); });
  panels.forEach(p => p.classList.toggle("active", p.id === `panel-${phase}`));
}

tabs.forEach(t => t.addEventListener("click", () => switchTab(t.dataset.phase)));

document.getElementById("btn-next-axial").addEventListener("click", () => { updateProgress("open"); switchTab("axial"); });
document.getElementById("btn-next-selective").addEventListener("click", () => { updateProgress("axial"); switchTab("selective"); });
document.getElementById("btn-go-export").addEventListener("click", () => { updateProgress("selective"); switchTab("export"); generateOutput(); });
document.getElementById("btn-back-open").addEventListener("click", () => switchTab("open"));
document.getElementById("btn-back-axial").addEventListener("click", () => switchTab("axial"));
document.getElementById("btn-back-selective").addEventListener("click", () => switchTab("selective"));

// â”€â”€ Progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateProgress(phase) {
  const map = { open: ["prog-open","done-teal"], axial: ["prog-axial","done-amber"], selective: ["prog-selective","done-rose"] };
  const [id, cls] = map[phase];
  document.getElementById(id).classList.add(cls);
}

// â”€â”€ Dynamic Open Theme Blocks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildOpenThemes() {
  const container = document.getElementById("open-themes-container");
  container.innerHTML = "";
  for (let i = 1; i <= state.openThemes; i++) {
    const div = document.createElement("div");
    div.className = "theme-block";
    div.innerHTML = `
      <div class="theme-block-header">
        <div class="theme-num">${i}</div>
        <strong style="font-size:0.9rem;">Open Code ${i}</strong>
      </div>
      <div class="grid-2">
        <div class="field">
          <label for="oc-name-${i}">Code label</label>
          <input id="oc-name-${i}" type="text" placeholder="Short label, e.g. Isolation imagery">
        </div>
        <div class="field">
          <label for="oc-evidence-${i}">Evidence &amp; examples</label>
          <textarea id="oc-evidence-${i}" placeholder="Specific lyric, timestamp, image, sound..."></textarea>
        </div>
      </div>`;
    container.appendChild(div);
  }
  // Add/remove buttons
  const btnRow = document.createElement("div");
  btnRow.style = "display:flex; gap:10px; margin-top:4px;";
  btnRow.innerHTML = `<button class="btn btn-ghost btn-sm" id="btn-add-code">+ Add code</button><button class="btn btn-ghost btn-sm" id="btn-rm-code">âˆ’ Remove last</button>`;
  container.appendChild(btnRow);
  document.getElementById("btn-add-code").addEventListener("click", () => { state.openThemes = Math.min(state.openThemes + 1, 12); buildOpenThemes(); });
  document.getElementById("btn-rm-code").addEventListener("click", () => { state.openThemes = Math.max(state.openThemes - 1, 1); buildOpenThemes(); });
}

// â”€â”€ Dynamic Axial Category Blocks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildAxialCategories() {
  const container = document.getElementById("axial-categories-container");
  container.innerHTML = "";
  for (let i = 1; i <= state.axialCategories; i++) {
    const div = document.createElement("div");
    div.className = "theme-block";
    div.innerHTML = `
      <div class="theme-block-header">
        <div class="theme-num amber">${i}</div>
        <strong style="font-size:0.9rem;">Category ${i}</strong>
      </div>
      <div class="grid-2">
        <div class="field">
          <label for="ax-name-${i}">Category name</label>
          <input id="ax-name-${i}" type="text" placeholder="e.g. Emotional Withdrawal">
        </div>
        <div class="field">
          <label for="ax-codes-${i}">Open codes grouped here</label>
          <input id="ax-codes-${i}" type="text" placeholder="e.g. Code 1, Code 3, Code 5">
        </div>
        <div class="field" style="grid-column:1/-1;">
          <label for="ax-desc-${i}">What does this category capture?</label>
          <textarea id="ax-desc-${i}" placeholder="Describe the broader pattern these codes share..."></textarea>
        </div>
      </div>`;
    container.appendChild(div);
  }
  const btnRow = document.createElement("div");
  btnRow.style = "display:flex; gap:10px; margin-top:4px;";
  btnRow.innerHTML = `<button class="btn btn-ghost btn-sm" id="btn-add-cat">+ Add category</button><button class="btn btn-ghost btn-sm" id="btn-rm-cat">âˆ’ Remove last</button>`;
  container.appendChild(btnRow);
  document.getElementById("btn-add-cat").addEventListener("click", () => { state.axialCategories = Math.min(state.axialCategories + 1, 10); buildAxialCategories(); });
  document.getElementById("btn-rm-cat").addEventListener("click", () => { state.axialCategories = Math.max(state.axialCategories - 1, 1); buildAxialCategories(); });
}

// â”€â”€ Dynamic Relationship Blocks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const relTypes = ["Causal condition", "Context", "Intervening condition", "Action/strategy", "Consequence", "Association", "Contradiction"];

function buildRelations() {
  const container = document.getElementById("relations-container");
  container.innerHTML = "";
  for (let i = 1; i <= state.relations; i++) {
    const div = document.createElement("div");
    div.className = "relation-block";
    div.innerHTML = `
      <div class="relation-header">
        <span class="arrow-badge">R${i}</span>
        Relationship ${i}
      </div>
      <div class="grid-2">
        <div class="field">
          <label for="rel-from-${i}">From category</label>
          <input id="rel-from-${i}" type="text" placeholder="Category A">
        </div>
        <div class="field">
          <label for="rel-to-${i}">To category</label>
          <input id="rel-to-${i}" type="text" placeholder="Category B">
        </div>
        <div class="field">
          <label for="rel-type-${i}">Relationship type</label>
          <select id="rel-type-${i}">${relTypes.map(r=>`<option>${r}</option>`).join("")}</select>
        </div>
        <div class="field">
          <label for="rel-desc-${i}">Description</label>
          <textarea id="rel-desc-${i}" placeholder="How does A relate to B in this song?"></textarea>
        </div>
      </div>`;
    container.appendChild(div);
  }
}

document.getElementById("btn-add-relation").addEventListener("click", () => { state.relations = Math.min(state.relations + 1, 10); buildRelations(); });

// Init all dynamic blocks
buildOpenThemes();
buildAxialCategories();
buildRelations();

// â”€â”€ Output Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll(".out-tab").forEach(t => {
  t.addEventListener("click", () => {
    document.querySelectorAll(".out-tab").forEach(x => x.classList.remove("active"));
    t.classList.add("active");
  });
});

// â”€â”€ Build Markdown â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildMarkdown() {
  const title  = get("song-title");
  const artist = get("song-artist");
  const year   = get("song-year");
  const genre  = get("song-genre");
  const link   = get("song-link");

  const lines = [];
  lines.push(`# ${title || "Song"} â€” Grounded Theory Coding Notes\n`);

  // Metadata
  if (title || artist || year || genre || link) {
    lines.push("## Song Info\n");
    if (title)  lines.push(`- **Title:** ${title}`);
    if (artist) lines.push(`- **Artist:** ${artist}`);
    if (year)   lines.push(`- **Year:** ${year}`);
    if (genre)  lines.push(`- **Genre:** ${genre}`);
    if (link)   lines.push(`- **Link:** ${link}`);
    lines.push("");
  }

  // â”€â”€ OPEN CODING â”€â”€
  lines.push("---\n## Phase 1 â€” Open Coding\n");

  // Structured listening
  const sound = get("sound-notes"), content = get("content-notes");
  if (sound || content) {
    lines.push("### Structured Listening\n");
    if (sound)   lines.push(`**Pass 1 â€” Sound:**\n${norm(sound)}\n`);
    if (content) lines.push(`**Pass 2 â€” Content:**\n${norm(content)}\n`);
  }

  // Code prompts
  const prompts = [
    ["Lyrical Themes & Content", "lyrical-themes"],
    ["Emotional & Affective Tone", "emotional-tone"],
    ["Structural & Linguistic Elements", "structural-elements"],
    ["Musical & Sonic Features", "musical-features"],
    ["Visual & Video Elements", "visual-elements"],
    ["Contextual Factors", "contextual-factors"],
    ["Additional Observations", "additional-notes"],
  ];
  prompts.forEach(([label, id]) => {
    const v = get(id);
    if (v) lines.push(`### ${label}\n${norm(v)}\n`);
  });

  // Open codes
  const ocLines = [];
  for (let i = 1; i <= state.openThemes; i++) {
    const name = get(`oc-name-${i}`), ev = get(`oc-evidence-${i}`);
    if (name || ev) {
      ocLines.push(`- **Code ${i}: ${name || "(unlabelled)"}**`);
      if (ev) ocLines.push(`  - Evidence: ${norm(ev)}`);
    }
  }
  if (ocLines.length) lines.push(`### Open Codes\n${ocLines.join("\n")}\n`);

  // â”€â”€ AXIAL CODING â”€â”€
  lines.push("---\n## Phase 2 â€” Axial Coding\n");

  const catLines = [];
  for (let i = 1; i <= state.axialCategories; i++) {
    const name = get(`ax-name-${i}`), codes = get(`ax-codes-${i}`), desc = get(`ax-desc-${i}`);
    if (name || desc) {
      catLines.push(`- **Category ${i}: ${name || "(unnamed)"}**`);
      if (codes) catLines.push(`  - Open codes: ${codes}`);
      if (desc)  catLines.push(`  - Description: ${norm(desc)}`);
    }
  }
  if (catLines.length) lines.push(`### Categories\n${catLines.join("\n")}\n`);

  const relLines = [];
  for (let i = 1; i <= state.relations; i++) {
    const from = get(`rel-from-${i}`), to = get(`rel-to-${i}`), type = get(`rel-type-${i}`), desc = get(`rel-desc-${i}`);
    if (from || to) {
      relLines.push(`- **R${i}:** ${from || "?"} â†’ ${to || "?"} *(${type})*`);
      if (desc) relLines.push(`  - ${norm(desc)}`);
    }
  }
  if (relLines.length) lines.push(`### Relationships Between Categories\n${relLines.join("\n")}\n`);

  // Paradigm model
  const paradigm = [
    ["Causal Conditions", "causal-conditions"],
    ["Central Phenomenon", "phenomenon"],
    ["Context", "context-factors"],
    ["Intervening Conditions", "intervening-cond"],
    ["Action / Strategies", "action-strategies"],
    ["Consequences", "consequences"],
  ];
  const paraLines = paradigm.map(([label, id]) => { const v = get(id); return v ? `- **${label}:** ${norm(v)}` : ""; }).filter(Boolean);
  if (paraLines.length) lines.push(`### Paradigm Model\n${paraLines.join("\n")}\n`);

  // â”€â”€ SELECTIVE CODING â”€â”€
  lines.push("---\n## Phase 3 â€” Selective Coding\n");

  const core = get("core-category"), coreJ = get("core-justification");
  if (core) {
    lines.push(`### Core Category: ${core}\n`);
    if (coreJ) lines.push(`${norm(coreJ)}\n`);
  }

  const story = get("storyline");
  if (story) lines.push(`### Story Line\n${norm(story)}\n`);

  const memos = [
    ["Key Analytical Insights", "memo-insights"],
    ["Gaps & Tensions", "memo-gaps"],
    ["Theoretical Saturation Notes", "memo-saturation"],
    ["Next Steps", "memo-next"],
  ];
  const memoLines = memos.map(([label, id]) => { const v = get(id); return v ? `**${label}:**\n${norm(v)}\n` : ""; }).filter(Boolean);
  if (memoLines.length) lines.push(`### Theoretical Memo\n${memoLines.join("\n")}`);

  const post = get("discussion-post");
  if (post) lines.push(`### Discussion Board Excerpt\n${norm(post)}\n`);

  return lines.join("\n").replace(/\n{3,}/g, "\n\n").trim() + "\n";
}

function buildQmd(markdown) {
  const title  = get("song-title");
  const date   = new Date().toISOString().split("T")[0];
  const yamlTitle = title ? `${title} â€” Grounded Theory Coding Notes` : "Song Analysis";
  const escape = (v) => v.replace(/"/g, '\\"');
  return `---\ntitle: "${escape(yamlTitle)}"\ndate: "${date}"\nauthor: ""\nformat: gfm\n---\n\n${markdown}`;
}

function slugify(v) {
  return (v || "grounded-theory").toLowerCase().replace(/[^a-z0-9\s-]/g, "").replace(/\s+/g, "-").replace(/-+/g, "-").replace(/^-|-$/g, "") || "grounded-theory";
}

// â”€â”€ Generate & Display â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let lastMarkdown = "";

function generateOutput() {
  lastMarkdown = buildMarkdown();
  const preview = document.getElementById("output-preview");
  preview.value = lastMarkdown;
  document.getElementById("output-area").style.display = "block";
  preview.scrollIntoView({ behavior: "smooth", block: "start" });
}

document.getElementById("btn-generate").addEventListener("click", generateOutput);

document.getElementById("btn-copy-md").addEventListener("click", async () => {
  const md = lastMarkdown || buildMarkdown();
  if (!md) return;
  await navigator.clipboard.writeText(md).catch(() => {});
  const btn = document.getElementById("btn-copy-md");
  btn.textContent = "âœ“ Copied!";
  setTimeout(() => btn.textContent = "Copy Markdown", 1500);
});

document.getElementById("btn-download-qmd").addEventListener("click", () => {
  const md  = lastMarkdown || buildMarkdown();
  const qmd = buildQmd(md);
  download(`${slugify(get("song-title"))}-grounded-theory.qmd`, qmd, "text/markdown");
});

document.getElementById("btn-download-md").addEventListener("click", () => {
  const md = lastMarkdown || buildMarkdown();
  download(`${slugify(get("song-title"))}-grounded-theory.md`, md, "text/markdown");
});

function download(filename, content, type) {
  const blob = new Blob([content], { type });
  const a    = document.createElement("a");
  a.href     = URL.createObjectURL(blob);
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(a.href);
}

// â”€â”€ Import QMD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById("btn-import").addEventListener("click", importQmd);
document.getElementById("btn-clear-import").addEventListener("click", () => {
  set("import-qmd", "");
  document.getElementById("import-status").textContent = "";
});

function importQmd() {
  const raw = document.getElementById("import-qmd").value;
  if (!raw.trim()) return;

  const status = document.getElementById("import-status");
  let populated = 0;

  // Extract YAML front matter title
  const titleMatch = raw.match(/^---[\s\S]*?title:\s*["']?(.+?)["']?\n/m);
  if (titleMatch) {
    const t = titleMatch[1].replace(/ â€” Grounded Theory Coding Notes/, "").replace(/\\"/g, '"');
    set("song-title", t);
    populated++;
  }

  // Helper: extract section content between ## heading and next ## or ---
  function extractSection(text, heading) {
    const esc = heading.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    const re  = new RegExp(`##\\s*${esc}\\n([\\s\\S]*?)(?=\\n##|\\n---|$)`, "i");
    const m   = text.match(re);
    return m ? m[1].trim() : null;
  }

  function extractSubSection(text, heading) {
    const esc = heading.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    const re  = new RegExp(`###\\s*${esc}\\n([\\s\\S]*?)(?=\\n###|\\n##|\\n---|$)`, "i");
    const m   = text.match(re);
    return m ? m[1].trim() : null;
  }

  // Song metadata
  function extractMeta(text, label) {
    const re = new RegExp(`^- \\*\\*${label}:\\*\\*\\s*(.+)$`, "m");
    const m  = text.match(re);
    return m ? m[1].trim() : null;
  }

  const info = extractSection(raw, "Song Info");
  if (info) {
    [["Artist", "song-artist"], ["Year", "song-year"], ["Genre", "song-genre"], ["Link", "song-link"]]
      .forEach(([label, id]) => { const v = extractMeta(info, label); if (v) { set(id, v); populated++; } });
  }

  // Structured listening
  const openSection = raw.match(/## Phase 1 â€” Open Coding([\s\S]*?)(?=## Phase 2|---|$)/i)?.[1] || "";
  function extractBold(text, label) {
    const esc = label.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    const re  = new RegExp(`\\*\\*${esc}\\*\\*\\n([\\s\\S]*?)(?=\\n\\*\\*|$)`);
    const m   = text.match(re);
    return m ? m[1].trim() : null;
  }
  if (openSection) {
    const sl = extractSubSection(openSection, "Structured Listening");
    if (sl) {
      const s1 = extractBold(sl, "Pass 1 â€” Sound:"); if (s1) { set("sound-notes", s1); populated++; }
      const s2 = extractBold(sl, "Pass 2 â€” Content:"); if (s2) { set("content-notes", s2); populated++; }
    }
    const labelMap = [
      ["Lyrical Themes & Content", "lyrical-themes"],
      ["Emotional & Affective Tone", "emotional-tone"],
      ["Structural & Linguistic Elements", "structural-elements"],
      ["Musical & Sonic Features", "musical-features"],
      ["Visual & Video Elements", "visual-elements"],
      ["Contextual Factors", "contextual-factors"],
      ["Additional Observations", "additional-notes"],
    ];
    labelMap.forEach(([label, id]) => {
      const v = extractSubSection(openSection, label);
      if (v) { set(id, v); populated++; }
    });
  }

  // Selective coding
  const selSection = raw.match(/## Phase 3 â€” Selective Coding([\s\S]*?)$/i)?.[1] || "";
  const coreMatch = selSection.match(/### Core Category: (.+)/);
  if (coreMatch) { set("core-category", coreMatch[1].trim()); populated++; }
  const storyV = extractSubSection(selSection, "Story Line"); if (storyV) { set("storyline", storyV); populated++; }
  const memoSection = extractSubSection(selSection, "Theoretical Memo") || "";
  [["Key Analytical Insights", "memo-insights"], ["Gaps & Tensions", "memo-gaps"],
   ["Theoretical Saturation Notes", "memo-saturation"], ["Next Steps", "memo-next"]]
    .forEach(([label, id]) => {
      const esc = label.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
      const m = memoSection.match(new RegExp(`\\*\\*${esc}:\\*\\*\\n([\\s\\S]*?)(?=\\n\\*\\*|$)`));
      if (m) { set(id, m[1].trim()); populated++; }
    });
  const postV = extractSubSection(selSection, "Discussion Board Excerpt"); if (postV) { set("discussion-post", postV); populated++; }

  status.textContent = populated > 0 ? `âœ“ ${populated} field(s) populated. Review and update your axial coding blocks manually.` : "âš  Could not detect fields. Make sure you paste a file generated by this tool.";
}

// â”€â”€ Reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById("btn-reset-all").addEventListener("click", () => {
  if (!confirm("Reset all fields? This cannot be undone.")) return;
  document.querySelectorAll("input[type='text'], input[type='url'], textarea, select").forEach(el => { el.value = ""; });
  lastMarkdown = "";
  document.getElementById("output-area").style.display = "none";
  document.querySelectorAll(".progress-step").forEach(el => el.className = "progress-step");
  switchTab("open");
});

// â”€â”€ Keyboard shortcut: Ctrl/Cmd+Enter â†’ generate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener("keydown", (e) => {
  if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
    generateOutput();
    switchTab("export");
  }
});

</script>
</body>
</html>
